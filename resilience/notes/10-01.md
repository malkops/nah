## Keepalived/vrrp

### Плавающие IP

**Плавающие IP** - это публичные IP-адреса, которые могут перенаправляться системой на приватные IP.

Плавающие IP-адреса позволяют:
- быстро переназначить доступный адрес в пуле на свободный ресурс для увеличения доступности;
- контролировать узлы сети инфраструктуры;
- контролировать работу серверов (как следствие).

Плавающие IP-адрес использует IP-адреса из виртуальных интерфейсов для маскировки исходящего трафика через интерфейсы:
- сетеве устройство (NIC);
- виртуальную локальную сеть (VLAN);
- интерфейс связывания (мосты).

Когда используется такой механизм, в сети кластера можно прозрачно распределять адреса между хостами.
Для достижения максимальной высокой доступности рекомендуется:
- используется несколько устройств 3 уровня;
- использовать несколько серверов приложений.

Плавающий IP не меняет публичный IP-адрес, для его работы создаются статические адреса, которые впоследствии и используются для распределения.

Если сервис развернут на 2 и более серверах кластера, будет происходить следующее:
- сервера будут репллицироваться между собой;
- исходящий трафик будет замаскирован;
- в случае отказа IP перейдет на другой узел.

В конфигурировании кластерной инфрастурктуры прекомендуется использовать плавающие IP-адреса.

Реализующие сервисы плавающих IP:
- keepalive;
- UCARP;
- clusterIP.

### Keepalived

**Keepalived** - сервис, который позволяет контролировать серверы и процессы для обеспечения высокой доступности инфаструктуры. Демон keepalived может мониторить веб-серверы и автоматически передавать трафик втоому серверу, если первый не отвечает.

**FHRP** - first hop redundancy protocol - это протоколы резервирования первого уровня. То есть это группа протоколов, которая позволяет обеспечить клиентов отказоустойчивым шлюзом.
Представители протоколов FHRP:
- **VRRP** - Virtual Router Redundancy Protocol;
- **HSRP** - Hot Standby Router Protocol, Hot Stendby Redundancy Protocol;
- **CARP** - Common Address Redundancy Protocol;
- **GLBP** - Gateway Load Balancing Protocol.

**VRRP** - протокол резервирования виртуальных маршрутизаторов - это сетевой протокол, который обеспечивает автоматическое назначение доступных маршрутизаторов протокола IP участвующим хостам. Данная технология увеличивает доступность и надежность маршрутизации путей за счет автоматического выбора шлюза по умолчанию в подсети IP.
Протокол реализует высокую доступность серверов путем создания виртуальных маршрутизаторов: основного и резервного, действующих как одна группа. Виртуальный маршрутизатор назначается шлюзом по умолчанию для участвующих хостов вместо физического маршрутизатора.
Если основной маршрутизатор выходит из строя, то протокол позволяет переключаться на резервный маршрутизатор. Физический маршрутизатор, который пересылает пакеты в любой момент времени, называется главным.
VRRP пердоставляет информацию о состоянии маршрутизатора, его активности, нагрузки, функционирования, обрабатываемых и обмениваемых этим маршрутизатором. Объем кадого экземпляра VRRP ограничен одной локальной сетью.