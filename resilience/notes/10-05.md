## Балансровка нагрузки

**Балансировка нагрузки** - это процесс распределения нагрузки на пул серверов. Распределение происходит на L4 (транспортный) или L7 (прикладной) уровнях модели OSI.

Балансировка дает:
- сокращение времени простоя;
- масштабируемость;
- отказоустойчивость.

Балансировщик нагрузки - это сервис, который занимается распределением нагрузки между пулом серверов приложений, стараясь максимизировать скорость и утилизировать ресурсы приложений.
Также гарантирует, что приложения не будут перегружены. Бывают hardware (железо) и software (приложение) решения.

### Алгоритмы балансировки

**Round Robin** - запросы распределяются по серверам последовательно.

**Weighted Round Robin** - тот же round robin, но имеет дополнительное свойство - вес сервера. С его помощью мы можем укзаать балансировщику, сколько трафика отправлять на тот или иной сервер.

**Least Connections** - очередь с приоритетом, которая отсортирована по количеству активных пользователей, где первый сервер имеет наименьшее количество соединений.

**Hash** - используется механизм хеширования. Он позволяет распределить запросы на основе хеша, для которого обычно используется IP или URL адреса. В таком случае, запросы от одного и того же IP будут направляться на один и тот же сервер.

### L4 и L7 балансировки

Балансировка нагрузки может осуществляться на 2 уровнях модели OSI:

**L4 (транспортный)** - балансировка TCP/UDP пакетов;
**L7 (прикладной)** - балансировка протоколов седьмого уровня (http/s, telnet, ftp и т.д.).

Плюсы:
- L4:
  - Более быстрый и эффективный, так как не работает с контентом;
  - Дешево балансировать запросы к БД по TCP;
  - NAT.
- L7:
  - Более умная балансировка на основе контента;
  - Все плюсы HTTP-протокола (мультиплексирование, TLS, кеши и т.д.).

Минусы:
- L4:
  - Нельзя настроить умную балансировку на основе контента.
- L7:
  - Более затратный вариант по ресурсам чем L4.
